!function(t){var e={};function r(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);class s{constructor(t){this.context=t.context||window,this.bindings=t.bindings||{},this.pressedKeys=new Set,this.context.addEventListener("keydown",this.addKey.bind(this)),this.context.addEventListener("keyup",this.deleteKey.bind(this))}addKey(t){t.key in this.bindings&&t.preventDefault(),this.pressedKeys.add(t.key)}deleteKey(t){t.key in this.bindings&&t.preventDefault(),this.pressedKeys.delete(t.key)}}class n{constructor(t=window){this.context=t,this.context.addEventListener("mousedown",function(t){}),this.context.addEventListener("mouseup",function(t){}),this.context.addEventListener("mousemove",function(t){})}}class i{constructor(t){this.media=t.toGenerator(),this.animateWait=0,this.executor=this.executor.bind(this)}executor(t){setTimeout(t,this.animateWait,this.media.next().value)}step(){return new Promise(this.executor)}async render(t,e,r=null){for(;r=await this.step();){const s=e.locate(r);t.context.fillRect(s.slice(0),s.slice(1),1,1)}}static matches(t){return t.data instanceof Float64Array}}class a{constructor(t){this.media=t}createBitmap(){const[t,e]=this.media.header.shape;return createImageBitmap(new ImageData(this.media.data,e,t))}async render(t,e){t.context.drawImage(await this.createBitmap(),e.origin.slice(0),e.origin.slice(1))}static matches(t){return t.data instanceof Uint8ClampedArray}}class c{constructor(t){this.source=this.introspect(t)}introspect(t){for(const e of c.getSources())if(e.matches(t))return new e(t);return null}static getSources(){return[i,a]}}class o{static*getIntegerRange(t,e,r){for(;t<e;)yield t,t+=r}static isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}static product(t){return t.reduce(function(t,e){return t*e},1)}static add(t,e){return t+e}static multiply(t,e){return t*e}static divide(t,e){return t/e}static subtract(t,e){return t-e}}class h{static*flatten(t){for(let e=0;e<t.length;e++)Array.isArray(t[e])?yield*h.flatten(t[e]):yield t[e]}static slice(t,e){return e.length?h.slice(t[e[0]],e.slice(1)):t}static createRawArray(t,e=(()=>0)){return t.length?new Array(t[0]).fill(null).map(function(){return h.createRawArray(t.slice(1),e)}):e()}static cycle(t,e){const r=[...t];return r.splice(-e%r.length).concat(r)}static insert(t,e,r){1!==e.length?h.insert(t[e[0]],e.slice(1),r):t[e[0]]=r}static getShape(t,e=[]){return t.length?h.getShape(t[0],e.concat(t.length)):e}static*getGenerator(t){yield*t}static getAutoInvokingGenerator(t){return function(){return t.next().value}}}class u{static stringSandwhich(t,e,r,s){return t.repeat(s[0])+e.repeat(s[1])+r.repeat(s[2])}static escapeRegExp(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}}class d{static getTemplateArrayString(t){return t.reduce(function(t,e){return t.replace(/\$/g,new Array(e).fill("[$]").join(","))},"[$]")}static formatArrStrLikeNumpy(t,e){for(;--e>0;){const r=u.stringSandwhich("]",",","[",[e,1,e]),s=u.stringSandwhich("]","\n","[",[e,e,e]),n=u.escapeRegExp(r);t=t.replace(new RegExp(n,"g"),s)}return t}}class l{static getDataFromIndex(t,e){return e.data[e.header.offset+t.reduce(function(t,r,s){return t+r*e.header.stride[s]},0)]}static*getValueSequenceGenerator(t){for(const e of this.getIndices(t.header.shape))yield this.getDataFromIndex(e,t)}static getRawFlat(t){return[...this.getValueSequenceGenerator(t)]}static getValueSequenceAutoGenerator(t){const e=this.getValueSequenceGenerator(t);return h.getAutoInvokingGenerator(e)}static helperToString(t){const e=d.getTemplateArrayString(t.header.shape),r=this.getValueSequenceAutoGenerator(t),s=e.replace(/\[\$\]/g,r);return d.formatArrStrLikeNumpy(s,t.header.shape.length)}static*getIndices(t,e=[]){for(let r=0;r<t[0];r++)t.length>1?yield*this.getIndices(t.slice(1),e.concat(r)):yield e.concat(r)}static helperArange(t){return 1===t.length?[...o.getIntegerRange(0,t[0],1)]:2===t.length?[...o.getIntegerRange(t[0],t[1],1)]:3===t.length?[...o.getIntegerRange(t[0],t[1],t[2])]:void 0}}class p{static compareTypes(t,e){return p.TYPE_RANKINGS[t]>p.TYPE_RANKINGS[e]?t:e}}p.TYPE_MAP={uint8:Uint8ClampedArray,int8:Int8Array,uint16:Uint16Array,int16:Int16Array,uint32:Uint32Array,int32:Int32Array,float32:Float32Array,float64:Float64Array},p.TYPE_RANKINGS={uint8:0,int8:1,uint16:2,int16:3,uint32:4,int32:5,float32:6,float64:7};class g{static getStride(t,e=1){return t.reduceRight(function(t,e){return[e*t[0]].concat(t)},[e]).slice(1)}static isContiguousSlice(t){const e=[...t.keys()].filter(function(e){return!(t[e]>=0)});if(!e.length)return!0;for(let t=0,r=1;r<e.length;t++,r++)if(e[t]+1!==e[r])return!1;return!0}}class y{constructor(t){this.shape=t.shape,this.stride=void 0!==t.stride?t.stride:g.getStride(this.shape),this.offset=void 0!==t.offset?t.offset:0,this.contig=void 0===t.contig||t.contig}copy(){return new y(JSON.parse(JSON.stringify(this)))}slice(t){const e=this.copy();e.contig=g.isContiguousSlice(t);for(let r=0,s=0;r<this.shape.length;r++)t[r]>=0&&(e.offset+=this.stride[r]*t[r],e.stride.splice(r-s,1),e.shape.splice(r-s,1),s++);return e}reshape(t){const e=this.copy(),r=e.stride.slice(-1).pop();return e.shape=t,e.stride=g.getStride(t,r),e}transpose(){const t=this.copy();return t.stride.reverse(),t.shape.reverse(),t.contig=!1,t}}class f{static add(t,e){return this.ElementwiseOperation(t,e,o.add)}static multiply(t,e){return this.ElementwiseOperation(t,e,o.multiply)}static divide(t,e){return this.ElementwiseOperation(t,e,o.divide)}static subtract(t,e){return this.ElementwiseOperation(t,e,o.subtract)}static ElementwiseOperation(t,e,r){const s=p.compareTypes(t.type,e.type),n=t.header.shape,i=new s(o.product(n)),a=new y({shape:n});let c=0;for(const s of l.getIndices(n))i[c++]=r(l.getDataFromIndex(s,t),l.getDataFromIndex(s,e));return[i,a,s]}}class m{c1(t,e="float64"){const r=h.flatten(t),s=h.getShape(t);return this.type=p.TYPE_MAP[e],this.data=new this.type(r),this.header=new y({shape:s}),this}c2(t,e,r){return this.data=t,this.header=e,this.type=r,this}static array(t,e="float64"){return(new m).c1(t,e)}static arange(...t){return(new m).c1(l.helperArange(t))}static zeros(...t){return(new m).c1(h.createRawArray(t))}add(t){const[e,r,s]=f.add(this,t);return(new m).c2(e,r,s)}subtract(t){const[e,r,s]=f.subtract(this,t);return(new m).c2(e,r,s)}multiply(t){const[e,r,s]=f.multiply(this,t);return(new m).c2(e,r,s)}divide(t){const[e,r,s]=f.divide(this,t);return(new m).c2(e,r,s)}slice(...t){const e=this.header.slice(t);return e.shape.length?(new m).c2(this.data,e,this.type):this.data[e.offset]}reshape(...t){return this.header.contig?(new m).c2(this.data,this.header.reshape(t)):(new m).c2(new this.type(l.getRawFlat(this)),new y({shape:t}),this.type)}dot(t){const[e,r,s]=function(t,e){const r=t.header.shape[1],s=p.compareTypes(t.type,e.type),n=[t.header.shape[0],e.header.shape[1]],i=new y({shape:n}),a=new s(o.product(n));for(let s=0,n=0;s<i.shape[0];s++)for(let c=0;c<i.shape[1];c++){for(let i=0;i<r;i++)a[n]+=l.getDataFromIndex([s,i],t)*l.getDataFromIndex([i,c],e);n++}return[a,i,s]}(this,t);return(new m).c2(e,r,s)}T(){return(new m).c2(this.data,this.header.transpose())}toRawArray(){const t=l.getValueSequenceAutoGenerator(this);return h.createRawArray(this.header.shape,t)}*toGenerator(t=0){for(let e=0;e<this.header.shape[t];e++)yield this.slice(e)}inspect(){return this.toString()}toString(){return l.helperToString(this)+"\n"}}class w{constructor(t){this.origin=t.origin,this.size=t.size}locate(t){return this.origin.add(t)}}w.DEFAULT_LAYOUT={origin:m.array([100,150,0]),size:{X:250,Y:250,Z:250}};var S={parseSocketMessage:function(t){const e=JSON.parse(t);return[e.rawArray,e.arrayType]}};class v{constructor(t){this.layoutManager=new w(t.layout),this.mediaManager=new c(t.data)}render(t){this.mediaManager.source.render(t,this.layoutManager)}static createFromSocketMessage(t){const[e,r]=S.parseSocketMessage(t.data);return new v({data:m.array(e,r),layout:w.DEFAULT_LAYOUT})}}new class{constructor(t){this.scene=t.scene,this.socket=t.socket,this.pods=t.pods||[],this.socket.listen("message",this.addPodFromSocketMessage.bind(this)),window.setInterval(this.render.bind(this))}addPodFromSocketMessage(t){this.pods.push(v.createFromSocketMessage(t))}render(){this.scene.render(this.pods.slice())}}({scene:new class{constructor(t){this.canvas=t.canvas||document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.keyboard=t.keyboard||new s({}),this.mouse=t.mouse||new n,this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight}render(t,e=null){for(;e=t.pop();)e.render(this)}}({}),socket:new class{constructor(t){this.port=t.port||3e3,this.host=t.host||"localhost",this.socket=new WebSocket(`ws://${this.host}:${this.port}/`)}listen(t,e){this.socket.addEventListener(t,e)}}({})})}]);